/******************************************************** Konferanssystem Program:%M% Version:  %I% Date:       %D% Programmet hanterar meddelanden  i ett konferanssystem written by Casimir Artmann. Copyright Casimir Artmann. 1996-1998. *********************************************************/#include <stdio.h>#include <stdlib.h>#include <string.h>#include <time.h>#define TRUE 1#define FALSE 0     /* funktioner för hantering av cgi-anrop och felhantering */#include "../cgi.h"  #include "../utils.h"  /* gemensamma funktioner för konferanssystemet */  #include "intra.h"#include "db.h"  #include "html.h"  /* följande funktioner anropas  */       /* expandMethod     expandArticle       saveArticle               - spara artikel     readArticle               - hämta en artikel     readSubject               - hämta en eller flera rubriker      readNewsgroup             - hämta en eller fler namn på nyhetsgrupper     printConferanceMenuHTML   - skriv ut tillgängliga menyval     printNewsgroupHTML        - skriv ut valda nyhetsgrupper     printSubjectHTML          - skriv ut valda rubriker     printArticleHTML          - skriv ut en artikel     printArticleForm          - skriv ut ett HTML-formulär för skriva en artikel           */   /* huvudprogram message */main ( int argc, char *argv[] ){char path[255] ;int method ;                   /* vad skall programmet utföra */char *instring ;               /* inläst teckensträng */struct _CGI CGI ; struct _CGIarg CGIarg ; struct _user user ;            /* information om användaren */struct _message message ;      /* aktuell artikel/artiklar */struct _category category ;  /* kategori för inlägget */  /* läs in CGI environment */message.indent = 0 ;message.comment = 0 ;message.category = 0 ;message.subject = 0 ;message.id = 0 ;message.owner = -1 ;message.title[0] = (char) NULL ;message.author[0] = (char) NULL ;message.email[0] = (char) NULL ;message.text[0] = (char) NULL ;message.company[0] = (char) NULL ;message.created[0] = (char) NULL ;message.reply[0] = (char) NULL ;strcpy ( path, argv[0] ) ;InitIntra ( path ) ;InitCGI () ;GetCGI ( &instring, &CGI ) ;       /* konvertera värden från formulär */bURLencode ( instring, &CGIarg ) ;ExpandMethod ( &CGIarg, &method ) ;ExpandMessage ( &CGIarg, &message ) ;/* hämta information om användaren    baserat på inloggning  via WWW-server */   findUser ( CGI.remote_user, &user ) ;  /* visa ett inlägg */                       if ( method == SELECT )  {                        catHTML ( HEADER ) ;           /* skriv ut ett sidhuvud i HTML     */                                  /* skriv ut meny för konferanssystem */   selectMessage( message.category, message.subject, message.id, &message ) ;         if  (!FRAMES)      exit(0) ;   printMessageHTML ( user, message ) ; /* skriv ut artikel som HTML-kod    */   catHTML ( FOOTER ) ;           /* skriv ut en sidfot i HTML        */  }  /* visa ett inlägg */                       if ( method ==  EDIT )  {   catHTML ( HEADER ) ;           /* skriv ut ett sidhuvud i HTML     */                                  /* skriv ut meny för konferanssystem */   if ( !FRAMES )    exit(0) ;   if ( message.id != 0 )    /* befintligt inlägg skall ändras  */        {     selectMessage ( message.category, message.subject, message.id, &message ) ;       }    if ( user.id > 0 )   /* om inte inloggad användare nollställ namn */     {      strcpy ( message.author, user.name ) ;      strcpy ( message.email, user.epost ) ;      message.owner = user.id ;     }   if ( strcmp ( EDITION, "Limited"))   {     if ( message.category > 0  )       printMessageForm ( message ) ; /* skriv ut ett formulär för ett nytt meddelande */	 else	 { category.id = message.category  ;  	   printMessageCategoryForm ( category ) ;    /* välj vilken katagori som avses */	 }   }   else	 printMessageForm ( message ) ;   catHTML ( FOOTER ) ;                         /* skriv ut en sidfot i HTML        */  }  /* lägg till ett nytt inlägg */                       if ( method == INSERT )  {   catHTML ( HEADER ) ;           /* skriv ut ett sidhuvud i HTML     */                                  /* skriv ut meny för konferanssystem */  if (!FRAMES )    exit (0) ;  message.owner = user.id ;       /* inlägg */  saveMessage ( &message ) ;      /* spara artikel */       printMessageHTML ( user, message ) ; /* skriv ut artikel som HTML-kod    */    catHTML ( FOOTER ) ;           /* skriv ut ett sidhuvud i HTML     */    }  /* visa ett inlägg */                       if ( method == DELETE )  {   catHTML ( HEADER ) ;           /* skriv ut ett sidhuvud i HTML     */   if ( !FRAMES )    exit(0) ;                                /* skriv ut meny för konferanssystem */     deleteMessage ( &message ) ;      /* radera artikel */   catHTML ( FOOTER ) ;           /* skriv ut ett sidhuvud i HTML     */   exit ( FALSE ) ;  }if ( method == UPDATE )  {  catHTML ( HEADER ) ;           /* skriv ut ett sidhuvud i HTML     */  if ( !FRAMES )    exit(0) ;   updateMessage( &message ) ;     /* spara artikel */       printMessageHTML ( user, message ) ; /* skriv ut artikel som HTML-kod    */      catHTML ( FOOTER ) ;           /* skriv ut ett sidhuvud i HTML     */    }return ( TRUE ) ;                     }  /* end of main () */
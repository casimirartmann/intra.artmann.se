/*********************************************************************** Administration program for Intra Program: %M% Version: %I% Date:    %D%*************************************************************************/#include <stdio.h>#include <stdlib.h>#include <string.h>#include <time.h>#include "../cgi.h"#include "../utils.h"#include "intra.h"#include "db.h"#include "html.h"int InitialInstallation () ;void CreateInit () ;void CreateDB () ;void CreateUser () ;int insertUser ( struct _user user ) ; int deleteUser ( struct _user user ) ;int changeUser ( struct _user user ) ;int readUser ( struct _user *user ) ;int saveUser ( struct _user *user ) ;int CreateResource ( LANGUAGE ) ;int CreateHeader ( HEADER ) ;int CreateFooter ( FOOTER, user ) ;main ( int argc, char *argv[] ){char path[128];struct _user user ;sprintf( path,".//") ;if ( InitialInstallation () ){   CreateInit () ;  CreateDB () ;  CreateUser () ;}  else{  InitIntra ( path ) ; } ;}  /* end of main admin */ /* check if intra.ini exists */int InitialInstallation () {FILE *fp ;if (( fp = fopen ( "intra.ini","r") ) == NULL ) {  return ( TRUE ) ;  }fclose ( fp ) ; /* file initra.ini exists */return ( FALSE ) ;}void CreateInit (){char string[255] ;FILE *fp ;sprintf( VERSION, "%I%") ;printf("Creating intial values for Intra %s\n\n", VERSION ) ;printf("Edition: <Standard> ") ;gets ( string ) ;strcpy ( EDITION, string ) ;string[0] = (char) NULL ;printf("Executable: <cgi> ") ;gets ( string ) ;strcpy ( EXECUTABLE, string ) ;string[0] = (char) NULL ;printf("Server path: </httpd> ") ;gets ( string ) ;strcpy ( SERVER_ROOT, string ) ;string[0] = (char) NULL ;printf("Document path: </httpd/htdocs> ") ;gets ( string ) ;strcpy ( HTML_PATH, string ) ;string[0] = (char) NULL ;printf ("DB-path: </httpd/db> ") ;gets ( string ) ;strcpy ( DB_PATH, string ) ;string[0] = (char) NULL ;printf("Homepage: </intra/index.html> ") ;gets ( string ) ;strcpy ( HOMEPAGE, string ) ;string[0] = (char) NULL ;printf ("Header: </intra/header.txt> ") ;gets ( string ) ;strcpy ( HEADER, string ) ;string[0] = (char) NULL ;printf ("Footer: </intra/footer.txt> ") ;gets ( string ) ;strcpy ( FOOTER, string ) ;string[0] = (char) NULL ;printf ("Virtual cgi-path: </cgi-bin/intra> ") ;gets ( string ) ;strcpy ( CGI_PATH, string ) ;string[0] = (char) NULL ;printf ("Virtual icon-path: </icons> ") ;gets ( string ) ;strcpy ( ICON_PATH , string ) ;string[0] = (char) NULL ;printf ("POP3/IMAP server: <localhost> ") ;gets ( string ) ;strcpy ( MAIL, string ) ;string[0] = (char) NULL ;printf ("SMPT server: <localhost> ") ;gets ( string ) ;strcpy ( SMTP, string ) ;string[0] = (char) NULL ;/* Sparar ned värden i inititeringsfilen */if (( fp = fopen ( "intra.ini","w") ) == NULL ) {  printf("admin: kan ej skapa intra.ini") ;  return ; }fprintf( fp, "ServerRoot %s\n", SERVER_ROOT ) ;fprintf( fp, "Directory %s\n", HTML_PATH ) ;fprintf( fp, "Homepage %s\n", HOMEPAGE ) ;fprintf( fp, "ScriptAlias %s\n", CGI_PATH ) ;fprintf( fp, "Database %s\n", DB_PATH ) ; fprintf( fp, "Mail %s\n", MAIL ) ;fprintf( fp, "SMTP %s\n", SMTP ) ;fprintf( fp, "Frames TRUE\n") ;fprintf( fp, "Header %s\n", HEADER ) ;fprintf( fp, "Footer %s\n", FOOTER ) ; fprintf( fp, "Icons %s\n", ICON_PATH ) ;fprintf( fp, "Executable %s\n", EXECUTABLE ) ;fprintf( fp, "Version %s\n", VERSION ) ;fprintf( fp, "Edition %s\n", EDITION ) ;fclose ( fp ) ;printf("\n") ;}void CreateDB () {char string[255] ;char filename[255] ;FILE *fp ;printf("Create initial databases for Intra %s \n\n", VERSION ) ;    /* category.*  resp group.* */             printf(".") ;    /* user.dat */printf(".") ;sprintf ( filename, "%s/user.dat", DB_PATH ) ;if (( fp = fopen ( filename, "w" )) == NULL ){ exit ( ERROR ) ;}fclose ( fp ) ;     /* subscribe */printf(".") ; sprintf ( filename, "%s/subscribe.dat", DB_PATH ) ;if (( fp = fopen ( filename, "w" )) == NULL ){ exit ( ERROR ) ;}fclose ( fp ) ; printf(".") ;printf("\n\n") ;}void CreateUser () {char string[255] ;struct _user user ;printf("Create users for Intra %s \n\n", VERSION ) ;printf ("Create guest account\n") ;printf ("userid: <%d>\n", ERROR ) ;user.id = ERROR ;printf ("username: <nobody> ") ;gets ( string ) ;strcpy ( user.login, string ) ;string[0] = (char) NULL ;printf ("Full name: <gäst> ") ;gets ( string ) ;strcpy ( user.name, string ) ;string[0] = (char) NULL ;printf ("E-mail: ") ;gets ( string ) ;strcpy ( user.epost, string ) ;string[0] = (char) NULL ;printf ("Homepage: ") ;gets ( string ) ;strcpy ( user.homepage, string ) ;string[0] = (char) NULL ;printf ("Company: ") ;gets ( string ) ;strcpy ( user.company, string ) ;string[0] = (char) NULL ;insertUser ( user ) ;printf ("Create administrator account\n") ;printf ("userid: <1> \n") ;user.id = 1 ;printf ("username: <admin> ") ;gets ( string ) ;strcpy ( user.login, string ) ;string[0] = (char) NULL ;printf ("Full name: <Administrator> ") ;gets ( string ) ;strcpy ( user.name, string ) ;string[0] = (char) NULL ;printf ("E-mail: ") ;gets ( string ) ;strcpy ( user.epost, string ) ;string[0] = (char) NULL ;printf ("Homepage: ") ;gets ( string ) ;strcpy ( user.homepage, string ) ;string[0] = (char) NULL ;printf ("Company: ") ;gets ( string ) ;strcpy ( user.company, string ) ;string[0] = (char) NULL ;insertUser ( user ) ;}  /*       */int CreateResource ( char *filename ) {}int CreateHeader ( char *filename ) {char background[255] = "" ;char bgcolor[12] = "#" ;char text[12] ="#" ;char link[12] = "#" ;char hlink[12] = "#" ;char vlink[12] = "#" ;FILE *fp ;fprintf ( fp, "<HTML>\n") ;fprintf ( fp, "<BODY BACKGROUND=\"%s\"> BGCOLOR=\" \" TEXT=\"\" LINK=\"%s\"HLINK=\"%s\" VLINK=\"%s\"> \n", background, bgcolor, text, link, hlink,vlink ) ;fclose ( fp ) ;}int CreateFooter ( char *filename, struct _user user  ){ FILE *fp ;/* create footer file with filename *//* add HTML-code for footer */fprintf ( fp, "<HR>\n") ;fprintf ( fp, "<ADDRESS>\n") ;fprintf ( fp, "%s<BR>\n", user.company ) ;fprintf ( fp, "homepage: <A HREF=\"%s\">%s</A><BR>\n", user.homepage, user.homepage ) ; fprintf ( fp, "e-mail: <A HREF=MAILTO:\"%s\">%s</A><BR>\n", user.epost, user.name ) ;fprintf ( fp, "</ADDRESS>\n") ;fprintf ( fp, "</BODY></HTML>\n") ;/* close header file */fclose ( fp ) ;} /* end of CreateFooter */readUser ( struct _user *user ) {return ( 0 ) ;}insertUser ( struct _user user ) {char filename[255] ;FILE *fp ;sprintf ( filename, "%s/user.dat", DB_PATH ) ;printf("%s\n", filename ) ;if (( fp = fopen ( filename, "a" )) == NULL ){ exit ( ERROR ) ;}fprintf ( fp, "%d\t%s\t%s\t%s\t%s\t%s\n", 		      user.id, user.login, user.name, 			  user.epost, user.company, user.homepage ) ;fclose ( fp ) ; return ( 0) ;}
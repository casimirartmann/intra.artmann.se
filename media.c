/******************************************************** Konferanssystem version 2.1 Programmet hanterar artikar  i ett konferanssystem Konferanssystem  program:  %M% version:  %I% date:     %D%   written by Casimir Artmann.   Copyright Casimir Artmann. 1996-1998. *********************************************************/#include <stdio.h>#include <stdlib.h>#include <string.h>#include <time.h>#define TRUE 1#define FALSE 0     /* funktioner för hantering av cgi-anrop och felhantering */#include "../cgi.h"  #include "../utils.h"  /* gemensamma funktioner för konferanssystemet */  #include "intra.h"#include "db.h"  #include "html.h"  /* följande funktioner anropas  */       /* expandMethod     expandArticle       insertArticle             - spara artikel     updateArticle             -	 selectArticle             - hämta en artikel	 deleteArticle             -          printArticleHTML          - skriv ut en artikel     printArticleForm          - skriv ut ett HTML-formulär för skriva en artikel           */ /* huvudprogram article */main ( int argc, char *argv[] ){char path[255] ;int method ;                   /* vad skall programmet utföra */char *instring ;               /* inläst teckensträng */ int counter ;                   /* antal inlägg som skall skrivas ut */struct _CGI CGI ; struct _CGIarg CGIarg ; struct _user user ;                 /* information om användaren */struct _article article ;           /* aktuell artikel/artiklar */ struct _category category ;  /* kategori för inlägget */struct _title *title ;                 /* rubriker för nyhetsgruppen */  /* läs in CGI environment */article.indent = 0 ;article.category = 0 ;article.subject = 0 ;article.id = 0 ;article.owner = -1 ;article.title[0] = (char) NULL ;article.author[0] = (char) NULL ;article.email[0] = (char) NULL ;article.text[0] = (char) NULL ;article.company[0] = (char) NULL ;    article.created[0] = (char) NULL ;strcpy ( path, argv[0] ) ;InitIntra ( path ) ;InitCGI () ;GetCGI ( &instring, &CGI ) ;     /* konvertera värden från formulär */bURLencode ( instring, &CGIarg ) ;ExpandMethod ( &CGIarg, &method ) ;ExpandArticle ( &CGIarg, &article ) ;/* hämta information om användaren    baserat på inloggning  via WWW-server */findUser ( CGI.remote_user, &user ) ;  /* visa ett inlägg */                       if ( method == SELECT )  {                        catHTML ( HEADER ) ;           /* skriv ut ett sidhuvud i HTML     */                                  /* skriv ut meny för konferanssystem */                 /* läs texten för en artikel */        selectArticle ( article.category, article.subject, article.id, &article ) ;   	/* skriv ut artikel som HTML-kod    */    if  (!FRAMES)      exit(0) ;    printArticleHTML ( user, article ) ;    catHTML ( FOOTER ) ;           /* skriv ut en sidfot i HTML        */  }  /* visa ett inlägg */                       if ( method ==  EDIT )  {   catHTML ( HEADER ) ;           /* skriv ut ett sidhuvud i HTML     */                                  /* skriv ut meny för konferanssystem */   if ( !FRAMES )     exit(0) ;   if ( article.id != 0 )    /* befintligt inlägg skall ändras  */    {     selectArticle ( article.category, article.subject, article.id, &article ) ;       }    if ( user.id > 0 )   /* om inte inloggad användare nollställ namn */   {      strcpy ( article.author, user.name ) ;      strcpy ( article.email, user.epost ) ;      article.owner = user.id ;     }   if ( strcmp ( EDITION, "Limited"))    {      if ( article.category > 0  )        printArticleForm ( article ) ; /* skriv ut ett formulär för ett nytt meddelande */     else	 { 	   category.id = article.category  ;       printArticleCategoryForm ( category ) ;    /* välj vilken katagori som avses */	 }     }  else     printArticleForm ( article ) ; /* skriv ut ett formulär för ett nytt meddelande */   catHTML ( FOOTER ) ;           /* skriv ut en sidfot i HTML        */  }  /* lägg till ett nytt inlägg */                       if ( method == INSERT )  {   catHTML ( HEADER ) ;           /* skriv ut ett sidhuvud i HTML     */                                  /* skriv ut meny för konferanssystem */  if (!FRAMES )    exit(0) ;  article.owner = user.id ;      insertArticle ( &article ) ;     /* spara artikel */    printArticleHTML ( user, article ) ; /* skriv ut artikel som HTML-kod    */    /*groupMail ( &article ) ;*/    catHTML ( HEADER ) ;           /* skriv ut ett sidhuvud i HTML     */    }  /* visa ett inlägg */                       if ( method == DELETE )  {   catHTML ( HEADER ) ;           /* skriv ut ett sidhuvud i HTML     */                                  /* skriv ut meny för konferanssystem */    if ( !FRAMES )     exit(0) ;   deleteArticle ( &article ) ;      /* radera artikel */   catHTML ( HEADER ) ;           /* skriv ut ett sidhuvud i HTML     */   exit ( FALSE ) ;  }if ( method == UPDATE )  {  catHTML ( HEADER ) ;           /* skriv ut ett sidhuvud i HTML     */  if ( !FRAMES )    exit ( 0 ) ;  updateArticle( &article ) ;     /* spara artikel */       printArticleHTML ( user, article ) ; /* skriv ut artikel som HTML-kod    */    groupMail ( &article ) ;     catHTML ( HEADER ) ;           /* skriv ut ett sidhuvud i HTML     */  exit ( TRUE ) ;    }return ( TRUE ) ;                     }  /* end of main () */
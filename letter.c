/******************************************************** Konferanssystem Program: %M% Version:  %I% Date:       %D%  Programmet hanterar meddelanden  i ett konferanssystem written by Casimir Artmann. Copyright Casimir Artmann. 1996-1998. *********************************************************/#include <stdio.h>#include <stdlib.h>#include <string.h>#include <time.h>#define TRUE 1#define FALSE 0     /* funktioner för hantering av cgi-anrop och felhantering */#include "../cgi.h"  #include "../utils.h"  /* gemensamma funktioner för konferanssystemet */  #include "intra.h"#include "db.h"  #include "html.h"  /* följande funktioner anropas  */       /* expandMethod     expandArticle       saveArticle               - spara artikel     readArticle               - hämta en artikel     readSubject               - hämta en eller flera rubriker      readsubject             - hämta en eller fler namn på nyhetsgrupper     printConferanceMenuHTML   - skriv ut tillgängliga menyval     printsubjectHTML        - skriv ut valda nyhetsgrupper     printSubjectHTML          - skriv ut valda rubriker     printArticleHTML          - skriv ut en artikel     printArticleForm          - skriv ut ett HTML-formulär för skriva en artikel           */ /* huvudprogram message */main ( int argc, char *argv[] ){char path[255] ;int method ;                   /* vad skall programmet utföra */char *instring ;               /* inläst teckensträng */struct _CGI CGI ; struct _CGIarg CGIarg ; struct _user user ;            /* information om användaren */struct _article article ;      /* aktuell artikel/artiklar */struct _subject subject ;      /* rubriker för nyhetsgruppen */ struct _category category ;  /* kategori för inlägget */  /* läs in CGI environment */strcpy ( path, argv[0] ) ;InitIntra ( path ) ;InitCGI () ;GetCGI ( &instring, &CGI ) ;        /* konvertera värden från formulär */bURLencode ( instring, &CGIarg ) ;ExpandMethod ( &CGIarg, &method ) ;ExpandArticle ( &CGIarg, &article ) ;/* hämta information om användaren    baserat på inloggning  via WWW-server */   findUser ( CGI.remote_user, &user ) ;  /* visa ett inlägg */                       if ( method == SELECT )  {                        catHTML ( HEADER ) ;           /* skriv ut ett sidhuvud i HTML     */                                  /* skriv ut meny för konferanssystem */  if  (!FRAMES)   printConferanceMenuHTML ( "article", article.subject, article.id, "" ) ;              /* läs alla rubriker för aktuell katagori och nyhetsgrupp    för att därefter hämta information om aktuell artikel */   subject.category = article.category ;   subject.id = article.subject ;   readSubject ( &subject,"ALL", "DATE","" ) ;      findSubject ( &article, &subject ) ;     /* läs texten för en artikel */   readArticle ( &article ) ;     /* läs artikel från fil */   printLetterHTML ( user, article ) ; /* skriv ut artikel som HTML-kod    */   catHTML ( FOOTER ) ;           /* skriv ut en sidfot i HTML        */  }  /* visa ett inlägg */                       if ( method ==  EDIT )  {   catHTML ( HEADER ) ;           /* skriv ut ett sidhuvud i HTML     */                                  /* skriv ut meny för konferanssystem */   if ( !FRAMES )     printConferanceMenuHTML ( "article", article.subject, article.id, "" ) ;     if ( article.id != 0 )    /* befintligt inlägg skall ändras  */    {     readArticle ( &article ) ;       subject.category = article.category ;     subject.id = article.subject ;          readSubject ( &subject,"ALL", "DATE","" ) ;        findSubject ( &article, &subject ) ;    }    if ( user.id > 0 )   /* om inte inloggad användare nollställ namn */     {      strcpy ( article.author, user.name ) ;      strcpy ( article.email, user.epost ) ;      article.owner = user.id ;     }   else     {      article.author[0] = (char) NULL ;      article.owner = -1 ;     }   if ( article.category > 0  )     printLetterForm ( article ) ; /* skriv ut ett formulär för ett nytt meddelande */  else     printLetterCategoryForm ( category ) ;    /* välj vilken katagori som avses */   catHTML ( FOOTER ) ;           /* skriv ut en sidfot i HTML        */  }  /* lägg till ett nytt inlägg */                       if ( method == INSERT )  {   catHTML ( HEADER ) ;           /* skriv ut ett sidhuvud i HTML     */                                  /* skriv ut meny för konferanssystem */  if (!FRAMES )    printConferanceMenuHTML ( "article", article.subject, article.id, "" ) ;    article.owner = user.id ;  saveMessage ( &article ) ;     /* spara artikel */       printLetterHTML ( user, article ) ; /* skriv ut artikel som HTML-kod    */  groupMail ( &article ) ;          /* gruppsändning av inlägg */    catHTML ( FOOTER ) ;           /* skriv ut ett sidhuvud i HTML     */    }  /* visa ett inlägg */                       if ( method == DELETE )  {   catHTML ( HEADER ) ;           /* skriv ut ett sidhuvud i HTML     */                                  /* skriv ut meny för konferanssystem */   printConferanceMenuHTML ( "article", article.subject, article.id, "" ) ;     errorHTML ("Funktionen är inte implementerad i denna version") ;   catHTML ( FOOTER ) ;           /* skriv ut ett sidhuvud i HTML     */   exit ( FALSE ) ;  }if ( method == UPDATE )  {   catHTML ( HEADER ) ;           /* skriv ut ett sidhuvud i HTML     */   errorHTML ("Funktionen är inte implementerad i denna version") ;   catHTML ( FOOTER ) ;           /* skriv ut ett sidhuvud i HTML     */   exit ( FALSE ) ;  }return ( TRUE ) ;                     }  /* end of main () */